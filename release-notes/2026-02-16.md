# OpenClaw v2.16 版本發佈說明 (2026-02-16)

## 概述

本版本包含以下主要變化：

- **功能更新**
  - Telegram 內嵌按鈕支援
  - iOS 背景聆聽與語音指令提示
  - 死循環檢測與指數退避機制
  - Heartbeat 工具警告控制
  - Discord 原生執行選項與可重複使用元件
  - QMD 多代理啟動與 Config ID 字串強制
  - WebSocket 連線穩定性改善

- **安全性提升**
  - Session 傳輸檔權限設為 0o600
  - Auth 設定自動過期與錯誤計數重置
  - Config 合併與 Patch 安全增強
  - 認證流程測試覆蓋率提升
  - 受信任代理驗證與 Provider-Auth 設定整合

- **錯誤修復**
  - Discord 文章建立與 ID 規範化
  - Telegram 流式傳輸、訊息分割與 Slash 命令競態條件
  - iOS 位置監控、Barge-In 與 Canvas 穩定性
  - Reasoning Replay ID 保留與 QMD 集合隔離
  - Cron 每日跳過、TTS 重複音訊與 Primary Model 速率限制恢復
  - Gateway 記憶 QMD 初始化

---

## 功能更新 (Features)

### 1. Telegram 內嵌按鈕樣式 (#18241)
- **用途**：在 Telegram 聊天中支援內嵌按鈕元件，提供使用者互動功能
- **解決問題**：原先僅能透過文字指令，現在支援視覺化互動按鈕
- **影響**：提升使用者體驗，符合現代聊天機器人介面標準

### 2. iOS 背景聆聽 (Background Listening) (#18261)
- **用途**：在 iOS 裝置上啟用背景 audio 監聽，支援語音指令檢測
- **解決問題**：應用程式切換到背景時無法接收語音指令
- **影響**：實現 iOS 裝置上的語音指令隨時待命功能

### 3. iOS Talk 語音指令提示 (Voice Directive Hints) (#18250)
- **用途**：顯示音訊指令提示，告知使用者語音輸入是否啟用
- **解決問題**：使用者不清楚何時可以使用語音指令
- **影響**：提升語音指令的可發現性與正確使用率

### 4. 死循環檢測與指數退避 (Stuck Loop Detection & Exponential Backoff) (#17118)
- **用途**：檢測代理輪詢死循環並實作指數退避機制
- **解決問題**：代理輪詢可能進入無限循環導致資源耗盡
- **影響**：保護系統在故障條件下的穩定性

### 5. Heartbeat 工具警告抑制 (Tool Warning Suppression) (#18497)
- **用途**：在 Heartbeat 操作期間抑制工具調用警告
- **解決問題**：無需工具的 Heartbeat 操作產生過多警告
- **影響**：減少日誌噪音，提高監控信噪比

### 6. Discord 可重複使用元件 (Reusable Component)
- **用途**：在 Discord 整合中支援可重複使用元件
- **解決問題**：重複建立相同元件浪費資源
- **影響**：提升 Discord 整合效能

### 7. Discord 原生執行選項 (Native Exec Options)
- **用途**：為 Discord 命令執行新增原生 exec 選項
- **解決問題**：執行命令需要額外設定
- **影響**：簡化 Discord 執行工作流程

### 8. Discord 按鈕元件白名單 (Per-Button Component Allowlist)
- **用途**：為 Discord 按鈕元件實作白名單機制
- **解決問題**：潛在不安全元件可能被注入
- **影響**：加強 Discord 整合安全性

### 9. 代理啟動上限提升 (Agents Bootstrap Cap Increase)
- **用途**：提升同時激活代理的上限
- **解決問題**：大規模代理部署受到速率限制
- **影響**：支援更大規模的多代理生产部署

### 10. Config: 強制 Discord ID 字串格式 (ID String Enforce) (#18220)
- **用途**：強制設定中的 Discord ID 使用字串類型
- **解決問題**：數值 ID 導致 Discord API 解析錯誤
- **影響**：提升設定穩定性與一致性

### 11. QMD 多代理啟動 (Multi-Agent Startup) (#18000)
- **用途**：修復多代理 QMD 初始化競爭條件
- **解決問題**：代理同時啟動導致 QMD 集合衝突
- **影響**：確保多代理記憶初始化的可靠性

### 12. Webchat 命令驗證 (Command Authentication) (#18000)
- **用途**：修復 Webchat 命令的內部供應商驗證
- **解決問題**：內部命令處理時驗證失敗
- **影響**：恢復 Webchat 命令功能

---

## 安全性提升 (Security)

### 1. Session 傳輸檔權限 (File Permissions) (#18066)
- **用途**：設定 Session 傳輸檔權限為 0o600 (僅擁有者讀寫)
- **解決問題**：檔案權限為 0o644，其他使用者可讀敏感資料
- **影響**：防止未經授權的資料存取

### 2. Auth 設定自動過期 (Auto-Expiry) (#03cadc4b7)
- **用途**：在活動狀態過期後自動失效認證設定
- **解決問題**：舊的認證設定長期有效
- **影響**：減少未使用凭证帶來的攻擊面

### 3. Auth 選擇選項測試覆蓋 (Test Coverage) (#9372df45f)
- **用途**：加強認證選擇選項的測試覆蓋
- **解決問題**：認證流程的邊緣案例未被測試
- **影響**：降低認證繞過的風險

### 4. 受信任代理驗證測試共用 (Trusted Proxy Test Sharing) (#9b7084956)
- **用途**：共用受信任代理驗證測試配置
- **解決問題**：測試程式碼重複導致覆蓋率不一致
- **影響**：提升安全測試的可靠性

### 5. AuthProvider 啟動設定重用 (Onboarding Config Reuse) (#db3480f9b)
- **用途**：重用認證供應商啟動測試配置
- **解決問題**：測試設置重複易引入配置錯誤
- **影響**：減少認證測試中的配置錯誤

### 6. Provider-Auth 設定快照類型整合 (Config Snapshot Typing) (#36a5ff813)
- **用途**：整合認證提供者設定快照的類型定義
- **解決問題**：類型不一致可能導致執行時錯誤
- **影響**：防止類型相關的安全問題

### 7. Auth 選擇設定斷言簡化 (Profile Assertions) (#a0e8f00b2)
- **用途**：簡化認證選擇設定的斷言邏輯
- **解決問題**：驗證邏輯重複增加維護負擔
- **影響**：確保認證配置驗證的一致性

### 8. Config 合併強化 (Merge Hardening) (#f4b2fd00b, #cb391f4bd)
- **用途**：強化物件-陣列合併的 fallback 邏輯
- **解決問題**：缺少 ID 的 config.patch 可能摧毀陣列
- **影響**：防止設定損壞與資料遺失

### 9. Config.patch 安全增強 (Safety Enhancement) (#c2a0cf0c2)
- **用途**：防止 config.patch 在缺少 ID 時摧毀陣列結構
- **解決問題**：部分更新期間發生陣列摧毁
- **影響**：保護使用者設定完整性

### 10. 模型驗證測試輔助整合 (Model Auth Test Helpers) (#b2aa6e094)
- **用途**：集中模型驗證測試輔助功能
- **解決問題**：測試程式碼重複降低測試覆蓋率
- **影響**：提升模型驗證測試可靠性

---

## 錯誤修復 (Bug Fixes)

### 1. Discord 文章建立 (Thread Creation) (#81d2a91a9)
- **用途**：建立非論壇文章時確保發送初始訊息
- **解決問題**：文章建立後缺少初始訊息
- **影響**：恢復 Discord 文章對話功能

### 2. Discord 目標數值 ID 規範化 (Target ID Normalization) (#3238bd78d)
- **用途**：將數值 Discord ID 轉換為字串格式
- **解決問題**：Discord API 拒絕數值 ID
- **影響**：提高 Discord 目標解析穩定性

### 3. Telegram 流式傳輸 (Streaming) (dbe804f9b)
- **用途**：修復使用擴展思考模型時的訊息覆蓋問題
- **解決問題**：擴展思考模型覆蓋先前訊息
- **影響**：確保 Telegram 流式傳輸的正確性

### 4. Telegram 訊息分割 (Message Split) (#c62b90a2b)
- **用途**：在 streamMode 禁用時防止訊息分割
- **解決問題**：不論 streamMode 設置，訊息皆被分割
- **影響**：保持非流式模式下的訊息完整性

### 5. Telegram Slash 命令競態條件 (Slash Command Race Condition) (b2aa6e094)
- **用途**：防止非中止 slash 命令與聊天回應產生競態
- **解決問題**：同時觸發導致順序混亂
- **影響**：確保訊息處理順序一致性

### 6. iOS 位置監控 (Location Monitor) (#5a39e13c9)
- **用途**：恢復 iOS 位置監控合併檔案
- **解決問題**：iOS 配對流程缺少關鍵檔案
- **影響**：確保 iOS 配對功能完整性

### 7. iOS Barge-In 閘道 (Barge-In Gate) (#9e26fe445)
- **用途**：將 Talk barge-in 依賴 isolated audio routes
- **解決問題**：語音中斷功能異常
- **影響**：恢復 iOS 語音指令中斷能力

### 8. Canvas iOS 穩定性 (Stability) (#44ef04561)
- **用途**：移植 Canvas 穩定性修復至 iOS 分支
- **解決問題**：Canvas 在 iOS 上閃爍與崩潰
- **影響**：改善 Canvas UI 在 iOS 上的穩定性

### 9. 代理訊息工具 Schema (Agent Message Tool Schema) (#c8a536e30)
- **用途**：根據聊天頻道限制訊息工具的 schema
- **解決問題**：不相容的工具參數被发送到頻道
- **影響**：防止頻道特定功能錯誤

### 10. Reasoning Replay ID 保留 (Reasoning Replay IDs) (#96eabcbe8)
- **用途**：保留 OpenAI reasoning replay 的 ID
- **解決問題**：replay 時 reasoning ID 遺失
- **影響**：確保 reasoning 功能正確運作

### 11. QMD 集合隔離 (Collection Isolation) (#b32ae6fa0)
- **用途**：為每個代理隔離 QMD 管理的集合
- **解決問題**：多個代理共享 QMD 集合造成干擾
- **影響**：確保多代理環境的資料隔離

### 12. Cron 每日跳過 (Daily Skipping) (#fec4be8de)
- **用途**：防止每日 Cron 任務因 48 小時跳躍而跳過
- **解決問題**：每日任務偶爾跳過執行
- **影響**：確保每日任務的可靠性

### 13. TTS 重複音訊 (Duplicate Audio) (#c2a0cf0c2)
- **用途**：防止 TTS 工具產生重複音訊
- **解決問題**：相同文字生成多次音訊
- **影響**：減少資源使用與重複播放

### 14. 主要模型速率限制恢復 (Primary Model Rate-Limit Recovery) (#39bb1b332)
- **用途**：速率限制冷卻後自動恢復主要模型
- **解決問題**：冷卻後仍使用備用模型，效能較差
- **影響**：確保速率限制事件後的最佳模型效能

### 15. Telegram 草稿流式預覽 (Draft Stream Preview) (#244ed9db3)
- **用途**：修復 replyToMode 啟用時草稿流式預覽的對應主題問題
- **解決問題**：預覽訊息出現在錯誤的主題
- **影響**：確保 Telegram 回應的正確性

### 16. CI 併發 Ref 基礎 (CI Concurrency Ref-Based) (#2983ef024)
- **用途**：使用 ref 基礎的併發控制替代 SHA
- **解決問題**：SHA 基礎併發導致不必要的中斷
- **影響**：提升 CI/CD 管道效率

### 17. Android SDK 使用 JDK 17 (JDK 17 for Android SDK) (#3daaa1942)
- **用途**：在 Android SDK 建置中使用 JDK 17
- **解決問題**：舊版 JDK 導致 Android 建置失敗
- **影響**：確保 Android 開發環境穩定

### 18. Docker 发行版 Tar 覆蓋 (Docker Release Tar Override) (#fb6dba205)
- **用途**：Docker 發行版使用 tar 7.5.9
- **解決問題**：不相容的 tar 版本導致建置失敗
- **影響**：確保 Docker 發行流程穩定

### 19. WebSocket 連線穩定性 (WebSocket Connection Stability)
- **用途**：修復 WebSocket 連線斷開問題
- **解決問題**：部分使用者發生連線不穩定
- **影響**：確保即時通訊的可靠性

### 20. Gateway 記憶 QMD 初始化 (Gateway Memory QMD) (#02c268eec)
- **用途**：在 Gateway 啟動時為所有代理初始化 QMD
- **解決問題**：代理啟動時記憶遺失
- **影響**：確保代理記憶的完整恢復

---

## 總結

| 類別 | 數量 | 重點摘要 |
|------|------|----------|
| 功能更新 | 12+ | Telegram 按鈕、iOS 背景聆聽、死循環檢測 |
| 安全性 | 10+ | 檔案權限、認證過期、Config 强化 |
| 錯誤修復 | 20+ | Discord 文章、Telegram 流式、Cron 問題 |

**發佈日期**: 2026-02-16  
**版本**: 2.16  
**狀態**: Production Ready
